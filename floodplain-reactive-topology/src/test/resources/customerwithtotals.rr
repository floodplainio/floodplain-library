|>database(resource='dvd',schema='public',table='customer')
	->joinWith(|>database(resource='dvd',schema='public',table='payment')
		->scan(key=ToString([customer_id])
			, Msg(total=ToDouble(0))
	        ,->set(@total=[@total]+[amount],@customer_id=[customer_id])
	        ,->set(@total=[@total]-[amount],@customer_id=[customer_id])
	    )
	    ->only(total=[@total], customer_id=[@customer_id])
    )
    ->set(total=[@total],customer_id=[@customer_id])
	->rownum()
	->sink(connector='@staffsheets','@CUSTOMER',connect=true,columns='customer_id,last_name,first_name,email,total')
//->sink(connector='@replication',collection='parmentpercustomer', '@PAYMENTPERCUSTOMER')
